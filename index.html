<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Hangman</title>
</head>
	<body>
		<div id="message">
			Display Stuff Here
		</div>
		<div>Category: <span id="category"></span></div>
		<div>
			<input id="guess" maxlength="1">
			<button id="guessBtn">Guess</button>
			<button id="resetBtn" hidden>Reset Game</button>
		</div>
		<div id="word"></div>
		<script>
			/*
				
				stuff needing implemented

				reset full game
					guesses
					matches
					misses

				validate input
					case agnostic
					account for spaces in words

				Better messaging

				improve UI
					center enitre board
					visualize hangman
						remove missed message?


				Feature
				Guess word
				change font
			*/

			const words = {
				"Place": [
					"Pequea",
					"New York",
					"Lancaster",
					"Conestoga"
				],
				"Name": [
					"Sean",
					"Greg",
					"Judy",
					"Winston Churchill"
				],
				"Animal": [
					"dog",
					"cat",
					"cow",
					"elephant",
					"horse",
					"donkey"
				]
			};
			
			let guesses = [];
			let word = '';
			let gameover = false;
			let misses = 0;
			let matches = 0;

			const AlphaPattern = new RegExp(/[a-zA-Z]/);
			const guessInput = document.getElementById('guess');
			const guessBtn = document.getElementById('guessBtn');
			const resetBtn = document.getElementById('resetBtn');
			const categorySpan = document.getElementById('category');
			const msgDiv = document.getElementById('message');
			const wordDiv = document.getElementById('word');

			const getRandomIndex = (arrayLength) => {
				return Math.floor(Math.random() * (arrayLength));
			};

			const getRandomWordFromArray = (array) => {
				const randomIndex = getRandomIndex(array.length);
				const randomWord = array[randomIndex];
				return randomWord;
			}

			const generatePlaceholders = () => {
				wordDiv.innerHTML = '';

				//['s','e','a','n']
				Array.from(word).forEach((letter, i) => {
					const placeHolder = blank.cloneNode(true);
					if (letter !== ' ') {
						placeHolder.style.borderBottom = '2px solid black';
					}
					placeHolder.id = `letter-${i}`;
					placeHolder.dataset.letter = letter;
					wordDiv.appendChild(placeHolder);
				});
			}

			const getWord = () => {
				const categories = Object.keys(words);
				const category = getRandomWordFromArray(categories);

				// update display with chosen category
				categorySpan.innerHTML = category;

				word = getRandomWordFromArray(words[category]);

				generatePlaceholders();
			};

			const endGameCheck = () => {
				if (word.replaceAll(' ', '').length === matches) { // win
					setSuccessMessage('You Win!')
					gameover = true;
				} else if (misses >= 6) { // loose
					setErrorMessage('You Loose! Game Over')
					gameover = true;
				}

				if (gameover) {
					resetBtn.hidden = false;	
				}
			};

			const blank = document.createElement('div');
			blank.style.display = 'inline-block';
			blank.style.width = '20px';
			blank.style.height = '20px';
			blank.style.marginRight = '10px';

			const setMessage = (message, color = 'black') => {
				msgDiv.style.color = color;
				msgDiv.innerHTML = message;
			}

			const setSuccessMessage = (successMessage) => {
				setMessage(successMessage, 'green');
			}

			const setErrorMessage = (errorMessage) => {
				setMessage(errorMessage, 'red');
			}

			const resetGame = () => {
				guesses = [];
				word = '';
				gameover = false;
				misses = 0;
				matches = 0;
				getWord();
				setMessage('New Game');
				resetBtn.hidden = true;
				guessInput.focus();
			}

			resetBtn.onclick = () => {
				resetGame();
			};		

			guessBtn.onclick = () => {
				let guessValue = guessInput.value;
				guessInput.value = '';

				if (gameover) {
					return;
				}

				if (!AlphaPattern.test(guessValue)) {
					setErrorMessage(`Character ${guessValue} is invalid!`);
					return;
				}

				guessValue = guessValue.toLowerCase();

				// check if letter has been guessed
				if (guesses.includes(guessValue)) {
					setMessage(`Letter ${guessValue} has already been guessed`);
				} else {
					guesses.push(guessValue);

					// check if letter is in the word
					if (word.toLowerCase().includes(guessValue)) {
						// something good
						Array.from(word).forEach((letter, i) => {
							if (guessValue === letter.toLowerCase()) {
								const placeHolder = document.getElementById(`letter-${i}`);
								placeHolder.innerText = letter;
								matches++;
							}
						});
						setSuccessMessage('Match Found!')
						endGameCheck();
					} else {
						misses++;
						setErrorMessage(`${misses} Miss${(misses > 1) ? 'es' : ''}`);
						endGameCheck();
					}
				}

				guessInput.focus();
			};

			resetGame();

		</script>		
	</body>
</html>