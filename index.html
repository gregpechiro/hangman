<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Hangman</title>
</head>
	<body>
		<div style="margin: auto; width: 50%; text-align: center;">
			<br><br>
			<div id="message">
				Display Stuff Here
			</div>
			<div>Category: <span id="category"></span></div>
			<div>
				<button id="resetBtn" hidden>Reset Game</button>
			</div>
			<div>
				<input id="guessWord">
				<button id="guessWordBtn">Guess Word</button>
			</div>
			<br>
			<div id="bodyPart-1" class="bodyPart" hidden>Head</div>
			<div id="bodyPart-2" class="bodyPart" hidden>Body</div>
			<div id="bodyPart-3" class="bodyPart" hidden>Left Arm</div>
			<div id="bodyPart-4" class="bodyPart" hidden>Right Arm</div>
			<div id="bodyPart-5" class="bodyPart" hidden>Left Leg</div>
			<div id="bodyPart-6" class="bodyPart" hidden>Right Leg</div>
			<br>
			<div id="word"></div>
		</div>

		<script>
			/*
				stuff needing implemented

				improve UI
					change font
					visualize hangman
						remove missed message?

				Clean up

				Feature
					remove input and button

				auto guessing
			*/

			const words = {
				"Place": [
					"Pequea",
					"New York",
					"Lancaster",
					"Conestoga"
				],
				"Name": [
					"Sean",
					"Greg",
					"Judy",
					"Winston Churchill"
				],
				"Animal": [
					"dog",
					"cat",
					"cow",
					"elephant",
					"horse",
					"donkey"
				]
			};
			
			let guesses = [];
			let word = '';
			let gameover = false;
			let misses = 0;
			let matches = 0;

			const guessWordInput = document.getElementById('guessWord');
			const guessWordBtn = document.getElementById('guessWordBtn');
			const resetBtn = document.getElementById('resetBtn');
			const categorySpan = document.getElementById('category');
			const msgDiv = document.getElementById('message');
			const wordDiv = document.getElementById('word');

			const blank = document.createElement('div');
			blank.style.display = 'inline-block';
			blank.style.width = '20px';
			blank.style.height = '20px';
			blank.style.marginRight = '10px';

			const getRandomIndex = (arrayLength) => {
				return Math.floor(Math.random() * (arrayLength));
			};

			const getRandomWordFromArray = (array) => {
				const randomIndex = getRandomIndex(array.length);
				const randomWord = array[randomIndex];
				return randomWord;
			}

			const generatePlaceholders = () => {
				wordDiv.innerHTML = '';

				//['s','e','a','n']
				Array.from(word).forEach((letter, i) => {
					const placeHolder = blank.cloneNode(true);
					if (letter !== ' ') {
						placeHolder.style.borderBottom = '2px solid black';
						placeHolder.className = 'placeholder'
					}
					placeHolder.id = `letter-${i}`;
					placeHolder.dataset.letter = letter;
					wordDiv.appendChild(placeHolder);
				});
			}

			const getWord = () => {
				const categories = Object.keys(words);
				const category = getRandomWordFromArray(categories);

				// update display with chosen category
				categorySpan.innerHTML = category;

				word = getRandomWordFromArray(words[category]);

				generatePlaceholders();
			};

			const revealWord = () => {
				const placeHolders = document.getElementsByClassName('placeholder');
				Array.from(placeHolders).forEach((placeholder) => {
					// const letter = placeholder.dataset.letter;
					// placeholder.innerHTML = letter;
					placeholder.innerText = placeholder.dataset.letter;
				});
			}

			const endGameCheck = (guessWord = '') => {
				if (word.replaceAll(' ', '').length === matches || word.toLowerCase() === guessWord.toLowerCase()) { // win
					setSuccessMessage('You Win!')
					gameover = true;
				} else if (guessWord !== '') {
					executeMiss();
				}

				if (!gameover && misses >= 6) { // loose
					setErrorMessage('You Loose! Game Over')
					gameover = true;
				}

				if (gameover) {
					resetBtn.hidden = false;
					guessWordInput.hidden = true;
					guessWordBtn.hidden = true;
					revealWord();
				}
			};

			const setMessage = (message, color = 'black') => {
				msgDiv.style.color = color;
				msgDiv.innerHTML = message;
			}

			const setSuccessMessage = (successMessage) => {
				setMessage(successMessage, 'green');
			}

			const setErrorMessage = (errorMessage) => {
				setMessage(errorMessage, 'red');
			}

			const executeMiss = () => {
				misses++;
				const bodyPart = document.getElementById(`bodyPart-${misses}`);
				bodyPart.hidden = false;
				setErrorMessage(`${misses} Miss${(misses > 1) ? 'es' : ''}`);
			}

			const resetGame = () => {
				guesses = [];
				word = '';
				gameover = false;
				misses = 0;
				matches = 0;
				getWord();
				setMessage('New Game');
				guessWordInput.hidden = false;
				guessWordBtn.hidden = false;

				const bodyParts = document.getElementsByClassName('bodyPart');
				Array.from(bodyParts).forEach((bodyPart) => {
					bodyPart.hidden = true
				});
				resetBtn.hidden = true;
				guessWordInput.blur();
			}

			resetBtn.onclick = () => {
				resetGame();
			};		

			// guessBtn.onclick = () => {
			document.addEventListener('keydown', (event) => {
				if (gameover || guessWordInput === document.activeElement || event.keyCode < 65 || event.keyCode > 90) {
					return;
				}

				let guessValue = event.key.toLowerCase();
				// guessValue = guessValue.toLowerCase();

				// check if letter has been guessed
				if (guesses.includes(guessValue)) {
					setMessage(`Letter ${guessValue} has already been guessed`);
				} else {
					guesses.push(guessValue);

					// check if letter is in the word
					if (word.toLowerCase().includes(guessValue)) {
						// something good
						Array.from(word).forEach((letter, i) => {
							if (guessValue === letter.toLowerCase()) {
								const placeHolder = document.getElementById(`letter-${i}`);
								placeHolder.innerText = letter;
								matches++;
							}
						});
						setSuccessMessage('Match Found!')
						endGameCheck();
					} else {
						executeMiss();
						endGameCheck();
					}
				}
			});

			guessWordBtn.onclick = () => {
				const guessWord = guessWordInput.value;
				guessWordInput.value = '';
				endGameCheck(guessWord);
			};

			resetGame();

		</script>		
	</body>
</html>